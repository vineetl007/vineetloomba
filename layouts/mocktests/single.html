{{ define "main" }}

<div class="container mx-auto px-4 py-6">
  <h1 class="text-2xl mb-4">{{ .Title }}</h1>

  {{/* Collect all questions (maths, physics, chemistry) */}}
  {{ $qMaths := slice }}{{ range .Params.maths_questions }}{{ $q := index (where $.Site.RegularPages "File.Path" .) 0 }}{{ if $q }}{{ $qMaths = $qMaths | append $q }}{{ end }}{{ end }}
  {{ $qPhysics := slice }}{{ range .Params.physics_questions }}{{ $q := index (where $.Site.RegularPages "File.Path" .) 0 }}{{ if $q }}{{ $qPhysics = $qPhysics | append $q }}{{ end }}{{ end }}
  {{ $qChem := slice }}{{ range .Params.chemistry_questions }}{{ $q := index (where $.Site.RegularPages "File.Path" .) 0 }}{{ if $q }}{{ $qChem = $qChem | append $q }}{{ end }}{{ end }}

  {{ $hasQs := or (gt (len $qMaths) 0) (gt (len $qPhysics) 0) (gt (len $qChem) 0) }}

  {{ if $hasQs }}
    <div id="mocktest-app" class="min-h-[500px]">
      <div class="flex justify-between items-center mb-4">
        <div id="sections" class="flex gap-4"></div>
        <div id="timer" class="text-xl font-bold text-red-500"></div>
      </div>

      <div id="question-container" class="mb-6"></div>

      <div id="nav" class="grid grid-cols-6 sm:grid-cols-10 gap-2 mb-6"></div>

      <button id="submit-test"
              class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-500 transition">
        Submit Test
      </button>
    </div>

    {{/* Embed questions as JSON for mocktest.js */}}
    <script type="application/json" id="mocktest-data">
    {
      "maths": [
        {{- range $i, $q := $qMaths -}}
          {
            "id": "M{{ $i }}",
            "question": "{{ $q.Params.question | safeJS }}",
            "options": [{{ range $j, $opt := $q.Params.options }}"{{ $opt | safeJS }}"{{ if not (eq (add $j 1) (len $q.Params.options)) }}, {{ end }}{{ end }}],
            "correctIndices": {{ $q.Params.correctIndices | jsonify }},
            "question_type": "{{ $q.Params.question_type }}",
            "numerical_answer": "{{ $q.Params.numerical_answer }}"
          }{{ if not (eq (add $i 1) (len $qMaths)) }},{{ end }}
        {{- end -}}
      ],
      "physics": [
        {{- range $i, $q := $qPhysics -}}
          {
            "id": "P{{ $i }}",
            "question": "{{ $q.Params.question | safeJS }}",
            "options": [{{ range $j, $opt := $q.Params.options }}"{{ $opt | safeJS }}"{{ if not (eq (add $j 1) (len $q.Params.options)) }}, {{ end }}{{ end }}],
            "correctIndices": {{ $q.Params.correctIndices | jsonify }},
            "question_type": "{{ $q.Params.question_type }}",
            "numerical_answer": "{{ $q.Params.numerical_answer }}"
          }{{ if not (eq (add $i 1) (len $qPhysics)) }},{{ end }}
        {{- end -}}
      ],
      "chemistry": [
        {{- range $i, $q := $qChem -}}
          {
            "id": "C{{ $i }}",
            "question": "{{ $q.Params.question | safeJS }}",
            "options": [{{ range $j, $opt := $q.Params.options }}"{{ $opt | safeJS }}"{{ if not (eq (add $j 1) (len $q.Params.options)) }}, {{ end }}{{ end }}],
            "correctIndices": {{ $q.Params.correctIndices | jsonify }},
            "question_type": "{{ $q.Params.question_type }}",
            "numerical_answer": "{{ $q.Params.numerical_answer }}"
          }{{ if not (eq (add $i 1) (len $qChem)) }},{{ end }}
        {{- end -}}
      ]
    }
    </script>

    <script src="/js/mocktest.js"></script>
  {{ else }}
    <p>No questions found for this mock test.</p>
  {{ end }}

  <div class="mt-6">
    <a href="/mocktest-bank/"
       class="inline-block bg-blue-500 text-white font-concert py-2 px-4 rounded hover:bg-blue-400 transition">
      â¬… Back to Mock Tests
    </a>
  </div>
</div>

{{ end }}
