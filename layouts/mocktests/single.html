{{ define "main" }}

<div class="container mx-auto px-4 py-6">
  <h1 class="text-2xl mb-4">{{ .Title }}</h1>

  {{ $mock := . }}
  {{ $subjects := $mock.Params.subjects }}
  
  {{/* Build subject-wise question store */}}
  <script>
    window.mockTestData = {};
  </script>

  {{ range $sub := $subjects }}
    {{ $qField := printf "%s_questions" (lower $sub) }}
    {{ $qPaths := index $mock.Params $qField }}
    
    <script>
      window.mockTestData["{{ $sub }}"] = [
        {{- range $i, $path := $qPaths -}}
          {{ $q := site.GetPage $path }}
          {
            id: {{ $i }},
            question: {{ printf "%q" $q.Params.question }},
            options: [
              {{- range $j, $opt := $q.Params.options -}}
                {{ printf "%q" $opt }}{{ if not (eq (add $j 1) (len $q.Params.options)) }},{{ end }}
              {{- end }}
            ],
            correctIndices: {{ $q.Params.correctIndices | jsonify }},
            solution: {{ printf "%q" $q.Params.solution }},
            question_type: {{ printf "%q" $q.Params.question_type }},
            numerical_answer: {{ printf "%q" $q.Params.numerical_answer }},
            difficulty: {{ if $q.Params.difficulty }}"{{ $q.Params.difficulty }}"{{ else }}""{{ end }},
            tags: {{ if $q.Params.tags }}{{ $q.Params.tags | jsonify }}{{ else }}[]{{ end }},
            video_url: {{ if $q.Params.video }}"https://www.youtube.com/embed/{{ $q.Params.video }}?start={{ $q.Params.start_time | default 0 }}&rel=0"{{ else }}""{{ end }}
          }{{ if not (eq (add $i 1) (len $qPaths)) }},{{ end }}
        {{- end -}}
      ];
    </script>
  {{ end }}

  {{/* Render the mock test app container */}}
  <div id="mocktest-app" class="min-h-[400px] mt-4"></div>

  <script src="/js/mocktest.js"></script>

</div>

{{ end }}
