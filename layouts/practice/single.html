{{ define "main" }}
<div class="container mx-auto px-4 py-6">
  <h1 class="text-2xl font-bold mb-4">{{ .Title }}</h1>

  {{/* Get current chapter + dpp from frontmatter */}}
  {{ $chapter := .Params.chapter }}
  {{ $dpp := .Params.dpp }}

  {{/* Fetch questions with matching chapter + dpp */}}
{{ $chapter := .Params.chapter }}
{{ $dpp := .Params.dpp }}

{{/* Step 1: filter questions section */}}
{{ $allQs := where .Site.RegularPages "Section" "questions" }}

{{/* Step 2: filter by chapter */}}
{{ $qsByChapter := where $allQs "Params.chapter" $chapter }}

{{/* Step 3: filter by dpp */}}
{{ $questions := where $qsByChapter "Params.dpp" $dpp }}


  {{ if gt (len $questions) 0 }}
    <div id="practice-questions">
      {{ range $index, $q := $questions }}
        <div class="question border rounded-lg p-4 mb-6 shadow">
          <h2 class="font-semibold mb-2">Q{{ add $index 1 }}. {{ $q.Params.question | markdownify }}</h2>
          
          <ul class="space-y-2">
            {{ range $i, $opt := $q.Params.options }}
              <li class="option cursor-pointer border rounded p-2 hover:bg-gray-100"
                  data-correct="{{ in $q.Params.correctIndices $i }}">
                {{ $opt | markdownify }}
              </li>
            {{ end }}
          </ul>

          <div class="solution mt-3 hidden text-green-700">
            <strong>Solution:</strong> {{ $q.Params.solution | markdownify }}
          </div>
        </div>
      {{ end }}
    </div>

    <script>
      document.querySelectorAll('.option').forEach(opt => {
        opt.addEventListener('click', () => {
          let parent = opt.closest('.question');
          let solution = parent.querySelector('.solution');

          if (opt.dataset.correct === "true") {
            opt.classList.add("bg-green-100", "border-green-400");
          } else {
            opt.classList.add("bg-red-100", "border-red-400");
          }
          solution.classList.remove("hidden");
        });
      });
    </script>

  {{ else }}
    <p>No questions found for this DPP.</p>
  {{ end }}
</div>
{{ end }}
